# 云记事本图片上传功能 - 规划文档 v3

## 需求概述

为云记事本增加图片上传功能：
1. 支持多种图床提供商（当前实现 GitHub，预留扩展）
2. 通过 EdgeOne Functions 代理图片链接
3. 新增管理面板页面，用于配置图床参数

## 技术方案

### 架构设计（可扩展）

```
┌─────────────┐     ┌──────────────────┐     ┌─────────────┐
│   前端      │────▶│  EdgeOne API     │────▶│  图床提供商  │
│  (React)    │     │  /api/images/*   │     │  - GitHub   │
└─────────────┘     └──────────────────┘     │  - R2 (未来)│
       │                    │                │  - COS(未来)│
       │                    │ 代理           └─────────────┘
       │                    ▼
       │            ┌──────────────────┐
       └───────────▶│  /api/images/    │
         加载图片    │  proxy?path=xxx  │
                    └──────────────────┘
```

## 功能模块

### 模块一：管理面板

**入口：** 右上角齿轮菜单 → 管理面板

**图床配置（可扩展设计）：**
- 提供商选择下拉框
- 根据选择显示对应配置表单
- 当前支持：GitHub
- 预留：Cloudflare R2、腾讯云 COS 等

### 模块二：后端 API

| 接口 | 方法 | 功能 |
|------|------|------|
| `/api/images/upload` | POST | 上传图片（根据配置选择提供商） |
| `/api/images/proxy` | GET | 代理图片链接 |
| `/api/images/delete` | DELETE | 删除图片 |
| `/api/settings/imagebed` | GET/PUT | 获取/保存图床配置 |

### 模块三：前端组件

| 组件 | 功能 |
|------|------|
| AdminPanel | 管理面板弹窗 |
| ImageBedConfig | 图床配置组件（可扩展） |
| ImageUploader | 图片上传组件 |

## UI 设计

### 管理面板弹窗（可扩展）

```
┌─────────────────────────────────────┐
│  管理面板                      [X]  │
├─────────────────────────────────────┤
│                                     │
│  📷 图床配置                        │
│  ─────────────────────────────────  │
│                                     │
│  图床提供商                         │
│  ┌─────────────────────────────┐   │
│  │ GitHub                    ▼ │   │
│  └─────────────────────────────┘   │
│   可选: GitHub / R2 / COS (未来)    │
│                                     │
│  ┌─ GitHub 配置 ─────────────────┐ │
│  │                               │ │
│  │  Token                        │ │
│  │  ┌───────────────────────┐   │ │
│  │  │ ghp_xxxxxxxxxxxx      │   │ │
│  │  └───────────────────────┘   │ │
│  │                               │ │
│  │  仓库 (owner/repo)            │ │
│  │  ┌───────────────────────┐   │ │
│  │  │ user/images           │   │ │
│  │  └───────────────────────┘   │ │
│  │                               │ │
│  │  分支: main  路径: img/uploads│ │
│  └───────────────────────────────┘ │
│                                     │
│         [测试连接]  [保存配置]      │
└─────────────────────────────────────┘
```

## 技术细节

### 配置存储结构（可扩展）

```typescript
// KV key: "settings:imagebed"
interface ImageBedSettings {
  provider: 'github' | 'r2' | 'cos';  // 可扩展
  github?: {
    token: string;
    repo: string;
    branch: string;
    path: string;
  };
  // 未来扩展
  r2?: { ... };
  cos?: { ... };
}
```

## 实施步骤

### 阶段一：管理面板 + 配置 API

- [ ] 1.1 创建 AdminPanel 弹窗组件
- [ ] 1.2 HomePage 齿轮菜单添加入口
- [ ] 1.3 创建 ImageBedConfig 组件（提供商选择 + GitHub 表单）
- [ ] 1.4 实现 `/api/settings/imagebed` API
- [ ] 1.5 配置保存到 KV

### 阶段二：后端图片 API

- [ ] 2.1 实现 `/api/images/upload`（GitHub 上传）
- [ ] 2.2 实现 `/api/images/proxy`（代理）
- [ ] 2.3 实现 `/api/images/delete`
- [ ] 2.4 错误处理和验证

### 阶段三：前端上传组件

- [ ] 3.1 创建 ImageUploader 组件
- [ ] 3.2 集成到编辑器工具栏
- [ ] 3.3 支持拖拽/粘贴上传
- [ ] 3.4 上传进度显示
