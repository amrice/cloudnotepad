# äº‘è®°äº‹æœ¬å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ - è§„åˆ’æ–‡æ¡£ v2

## éœ€æ±‚æ¦‚è¿°

ä¸ºäº‘è®°äº‹æœ¬å¢åŠ å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼š
1. ä½¿ç”¨ GitHub ä½œä¸ºå›¾åºŠå­˜å‚¨
2. é€šè¿‡ EdgeOne Functions ä»£ç† raw é“¾æ¥
3. æ–°å¢ç®¡ç†é¢æ¿é¡µé¢ï¼Œç”¨äºé…ç½®å›¾åºŠå‚æ•°

## æŠ€æœ¯æ–¹æ¡ˆ

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯      â”‚â”€â”€â”€â”€â–¶â”‚  EdgeOne API     â”‚â”€â”€â”€â”€â–¶â”‚   GitHub    â”‚
â”‚  (React)    â”‚     â”‚  /api/images/*   â”‚     â”‚   ä»“åº“      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚
       â”‚                    â”‚ ä»£ç†
       â”‚                    â–¼
       â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  /api/images/    â”‚
         åŠ è½½å›¾ç‰‡    â”‚  proxy?path=xxx  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å›¾ç‰‡ URL æ ¼å¼

```
ä¸Šä¼ åè¿”å›ï¼šhttps://your-domain.com/api/images/proxy?path=img/uploads/xxx.jpg
```

## åŠŸèƒ½æ¨¡å—

### æ¨¡å—ä¸€ï¼šç®¡ç†é¢æ¿

**å…¥å£ï¼š** å³ä¸Šè§’é½¿è½®èœå• â†’ ç®¡ç†é¢æ¿

**åŠŸèƒ½ï¼š**
- å›¾åºŠé…ç½®ï¼ˆGitHub Tokenã€ä»“åº“ã€åˆ†æ”¯ï¼‰
- é…ç½®ä¿å­˜åˆ° KV å­˜å‚¨
- é…ç½®çŠ¶æ€æ£€æµ‹

### æ¨¡å—äºŒï¼šåç«¯ API

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/images/upload` | POST | ä¸Šä¼ å›¾ç‰‡åˆ° GitHub |
| `/api/images/proxy` | GET | ä»£ç† GitHub raw é“¾æ¥ |
| `/api/images/delete` | DELETE | åˆ é™¤å›¾ç‰‡ |
| `/api/settings` | GET/PUT | è·å–/ä¿å­˜é…ç½® |

### æ¨¡å—ä¸‰ï¼šå‰ç«¯ç»„ä»¶

| ç»„ä»¶ | åŠŸèƒ½ |
|------|------|
| AdminPanel | ç®¡ç†é¢æ¿å¼¹çª— |
| ImageUploader | å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ |
| ç¼–è¾‘å™¨é›†æˆ | å·¥å…·æ å›¾ç‰‡æŒ‰é’® |

## å®æ–½æ­¥éª¤

### é˜¶æ®µä¸€ï¼šç®¡ç†é¢æ¿

- [ ] 1.1 åˆ›å»º AdminPanel ç»„ä»¶ï¼ˆå¼¹çª—å½¢å¼ï¼‰
- [ ] 1.2 åœ¨ HomePage é½¿è½®èœå•æ·»åŠ "ç®¡ç†é¢æ¿"å…¥å£
- [ ] 1.3 å®ç°å›¾åºŠé…ç½®è¡¨å•ï¼ˆTokenã€ä»“åº“ã€åˆ†æ”¯ï¼‰
- [ ] 1.4 åˆ›å»ºé…ç½® API (`/api/settings`)
- [ ] 1.5 é…ç½®ä¿å­˜åˆ° KV å­˜å‚¨

### é˜¶æ®µäºŒï¼šåç«¯å›¾ç‰‡ API

- [ ] 2.1 å®ç°å›¾ç‰‡ä¸Šä¼  API (`/api/images/upload`)
- [ ] 2.2 å®ç°å›¾ç‰‡ä»£ç† API (`/api/images/proxy`)
- [ ] 2.3 å®ç°å›¾ç‰‡åˆ é™¤ API (`/api/images/delete`)
- [ ] 2.4 æ·»åŠ é”™è¯¯å¤„ç†å’ŒéªŒè¯

### é˜¶æ®µä¸‰ï¼šå‰ç«¯ä¸Šä¼ ç»„ä»¶

- [ ] 3.1 åˆ›å»º ImageUploader ç»„ä»¶
- [ ] 3.2 é›†æˆåˆ° Markdown ç¼–è¾‘å™¨å·¥å…·æ 
- [ ] 3.3 æ”¯æŒæ‹–æ‹½/ç²˜è´´ä¸Šä¼ 
- [ ] 3.4 æ·»åŠ ä¸Šä¼ è¿›åº¦æ˜¾ç¤º

## UI è®¾è®¡

### ç®¡ç†é¢æ¿å…¥å£

```
é½¿è½®èœå•æ–°å¢é€‰é¡¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»é¢˜                â”‚
â”‚ â”œâ”€ è·Ÿéšç³»ç»Ÿ [å¼€å…³]  â”‚
â”‚ â””â”€ æ·±è‰²æ¨¡å¼ [å¼€å…³]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”§ ç®¡ç†é¢æ¿    â† æ–°å¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ ä¿®æ”¹å¯†ç          â”‚
â”‚ ğŸ”„ é‡ç½®ç³»ç»Ÿ         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸšª é€€å‡ºç™»å½•         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç®¡ç†é¢æ¿å¼¹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç®¡ç†é¢æ¿                      [X]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ğŸ“· å›¾åºŠé…ç½®                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                     â”‚
â”‚  GitHub Token                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ghp_xxxxxxxxxxxx            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  ä»“åº“åœ°å€ (owner/repo)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ username/image-repo         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  åˆ†æ”¯åç§°                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ main                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  ä¸Šä¼ è·¯å¾„å‰ç¼€                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ img/uploads                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚         [æµ‹è¯•è¿æ¥]  [ä¿å­˜é…ç½®]      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯ç»†èŠ‚

### é…ç½®å­˜å‚¨ç»“æ„

```typescript
// KV å­˜å‚¨ key: "settings:imagebed"
interface ImageBedSettings {
  provider: 'github';
  github: {
    token: string;      // GitHub PAT
    repo: string;       // owner/repo
    branch: string;     // main
    path: string;       // img/uploads
  };
}
```

### ä»£ç† API å®ç°

```typescript
// /api/images/proxy?path=img/xxx.jpg
export async function onRequest(context) {
  const { request, env } = context;
  const path = new URL(request.url).searchParams.get('path');

  // ä» KV è·å–é…ç½®
  const settings = await env.KV.get('settings:imagebed', 'json');
  const { repo, branch } = settings.github;

  // ä»£ç† GitHub raw
  const rawUrl = `https://raw.githubusercontent.com/${repo}/${branch}/${path}`;
  const response = await fetch(rawUrl);

  return new Response(response.body, {
    headers: {
      'Content-Type': response.headers.get('Content-Type'),
      'Cache-Control': 'public, max-age=31536000',
    },
  });
}
```
